<html>
<body>
<h1>CONTROL YOUR BODY</h1>
<img id="video" src="" alt="Video stream">

<h1>Press wasd to move body</h1>
<p id="move_str"></p>


<script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/3.0.4/socket.io.js" integrity="sha512-aMGMvNYu8Ue4G+fHa359jcPb1u+ytAF+P2SCb+PxrjCdO3n3ZTxJ30zuH39rimUggmTwmh2u7wvQsDTHESnmfQ==" crossorigin="anonymous"></script>
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

<script type="text/javascript">
var keyEnum = { W_Key:0, A_Key:1, S_Key:2, D_Key:3 };
var keyArray = new Array(4).fill(false);

const socket = io.connect('http://' + document.domain + ':' + location.port);

socket.on('video_frame', (data) => {
    $('#video').attr('src', 'data:image/jpeg;base64,' + data.image_data);
});
window.addEventListener('keydown', keydown_ivent);
window.addEventListener('keyup', keyup_ivent);

function keydown_ivent(e) {
	let key = '';
	switch (e.key) {
		case 'w':
                        keyArray[keyEnum.W_Key] = true;
                        break;
	}
	switch (e.key) {
		case 'a':
                        keyArray[keyEnum.A_Key] = true;
                        break;
	}
	switch (e.key) {
		case 's':
                        keyArray[keyEnum.S_Key] = true;
                        break;
	}
	switch (e.key) {
		case 'd':
                        keyArray[keyEnum.D_Key] = true;
                        break;
	}
}
function keyup_ivent(e) {
	let key = '';
	switch (e.key) {
		case 'w':
                        keyArray[keyEnum.W_Key] = false;
                        break;
	}
	switch (e.key) {
		case 'a':
                        keyArray[keyEnum.A_Key] = false;
                        break;
	}
	switch (e.key) {
		case 's':
                        keyArray[keyEnum.S_Key] = false;
                        break;
	}
	switch (e.key) {
		case 'd':
                        keyArray[keyEnum.D_Key] = false;
                        break;
	}
}

function isKeyDown(key)
{
    return keyArray[key];
}
setInterval(function(){
  var x = 0;
  var y = 0;
  if (isKeyDown(keyEnum.W_Key))
    x += 1;
  if (isKeyDown(keyEnum.S_Key))
    x -= 1;
  if (isKeyDown(keyEnum.D_Key))
    y -= 1;
  if (isKeyDown(keyEnum.A_Key))
    y += 1;
  console.log(x)
  socket.emit('control_command', {'x': x, 'y': y});

  document.getElementById("move_str").innerHTML = `Commanded motion: ${x}, ${y}`;

}, 50);
</script>
</html>
